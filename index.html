<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C System Call Master Quiz</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            box-sizing: border-box;
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
            margin-top: 0;
        }
        
        /* Menu Styles */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .menu-btn {
            padding: 20px;
            font-size: 1.1rem;
            background-color: #fff;
            border: 2px solid #007bff;
            color: #007bff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-weight: bold;
        }
        .menu-btn:hover {
            background-color: #007bff;
            color: white;
        }
        .menu-desc {
            font-size: 0.85rem;
            font-weight: normal;
            display: block;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* Quiz Styles */
        .progress {
            text-align: right;
            color: #666;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .question {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            line-height: 1.5;
            color: #2c3e50;
        }
        
        /* Hint Section */
        .hint-container {
            margin-bottom: 1.5rem;
        }
        .hint-toggle-btn {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: underline;
            padding: 0;
        }
        .hint-toggle-btn:hover {
            color: #495057;
        }
        .hint-box {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 0.95rem;
            font-family: monospace;
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: all 0.2s;
        }
        .btn:hover:not(:disabled) {
            background-color: #f8f9fa;
            border-color: #bdc3c7;
        }
        .btn.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .btn.wrong {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #e9ecef;
            display: none;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feedback-title {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        
        .action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .action-btn:hover {
            background-color: #0056b3;
        }
        .secondary-btn {
            background-color: #6c757d;
            margin-top: 10px;
        }
        .secondary-btn:hover {
            background-color: #5a6268;
        }

        /* Result Styles */
        .result-container {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }
        .score {
            font-size: 3rem;
            font-weight: bold;
            color: #007bff;
            margin: 20px 0;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

<div class="card">
    
    <div id="menu-view">
        <h1>C System Call Quiz</h1>
        <p style="text-align:center; color:#666;">æŒ‘æˆ¦ã—ãŸã„ãƒ¬ãƒ™ãƒ«ï¼ˆBatchï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        <div class="menu-grid">
            <button class="menu-btn" onclick="startQuiz(0)">
                Level 1: åŸºæœ¬ & ãƒ—ãƒ­ã‚»ã‚¹åˆ¶å¾¡
                <span class="menu-desc">Pipe, Fork, Exec, Zombie, COW ã®åŸºæœ¬å‹•ä½œ</span>
            </button>
            <button class="menu-btn" onclick="startQuiz(1)">
                Level 2: ã‚·ã‚°ãƒŠãƒ« & è©³ç´°ä»•æ§˜
                <span class="menu-desc">Blocking, SIGPIPE, dup2ã®æŒ™å‹•, ã‚¾ãƒ³ãƒ“å›å</span>
            </button>
            <button class="menu-btn" onclick="startQuiz(2)">
                Level 3: å¿œç”¨ & ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—
                <span class="menu-desc">PGID, Session, lseekã‚¨ãƒ©ãƒ¼, ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆå…±æœ‰</span>
            </button>
            <button class="menu-btn" onclick="startQuiz(3)">
                Level 4: ãƒãƒƒãƒ•ã‚¡ & ãƒ¡ãƒ¢ãƒª & è½ã¨ã—ç©´
                <span class="menu-desc">stdioãƒãƒƒãƒ•ã‚¡, mallocã¨fork, errno, åŸå­æ€§</span>
            </button>
        </div>
    </div>

    <div id="quiz-view" class="hidden">
        <div class="progress">Batch <span id="batch-label">1</span> - Q <span id="current-q">1</span> / <span id="total-q">10</span></div>
        
        <div class="question" id="question-text">Question here</div>

        <div class="hint-container">
            <button class="hint-toggle-btn" onclick="toggleHint()">ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
            <div id="hint-text" class="hint-box">ã“ã“ã«ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>

        <div class="options" id="options-container"></div>
        
        <div class="feedback" id="feedback">
            <span class="feedback-title" id="feedback-title"></span>
            <span id="feedback-text"></span>
        </div>
        
        <button class="action-btn hidden" id="next-btn" onclick="nextQuestion()">Next Question</button>
    </div>

    <div id="result-view" class="hidden result-container">
        <h2>Result</h2>
        <div class="score">Score: <span id="score-val">0</span> / <span id="score-total">0</span></div>
        <p id="result-message" style="font-size: 1.2rem;"></p>
        <button class="action-btn" onclick="initMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        <button class="action-btn secondary-btn" onclick="retryQuiz()">åŒã˜å•é¡Œã‚’ã‚„ã‚Šç›´ã™</button>
    </div>

</div>

<script>
    // === DATA SOURCE ===
    const batch1 = [
        { q: "æ›¸ãè¾¼ã¿å´ãŒé–‹ã„ã¦ã„ã‚‹ãŒãƒ‡ãƒ¼ã‚¿ãŒç©ºã®ãƒ‘ã‚¤ãƒ—ã«å¯¾ã—ã¦ read() ã‚’è¡Œã†ã¨ã©ã†ãªã‚‹ï¼Ÿï¼ˆO_NONBLOCKãªã—ï¼‰", options: ["0ã‚’è¿”ã™ï¼ˆEOFï¼‰", "ã‚¨ãƒ©ãƒ¼ï¼ˆ-1ï¼‰ã‚’è¿”ã™", "ãƒ‡ãƒ¼ã‚¿ãŒæ¥ã‚‹ã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå¾…æ©Ÿï¼‰ã™ã‚‹", "æœªå®šç¾©å‹•ä½œ"], correct: 2, rationale: "æ›¸ãæ‰‹ãŒã„ã‚‹é™ã‚Šã€ãƒ‡ãƒ¼ã‚¿ãŒæ¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€èª­ã¿è¾¼ã¿å´ã¯ãƒ‡ãƒ¼ã‚¿ãŒåˆ°ç€ã™ã‚‹ã‹æ›¸ãæ‰‹ãŒé–‰ã˜ã‚‹ã¾ã§å¾…æ©Ÿã—ã¾ã™ã€‚", hint: "man 2 read: 'If the pipe is empty... read() blocks until data is written.'" },
        { q: "æ›¸ãè¾¼ã¿å´ãŒå…¨ã¦é–‰ã˜ã‚‰ã‚ŒãŸãƒ‘ã‚¤ãƒ—ã«å¯¾ã—ã¦ read() ã‚’è¡Œã†ã¨ã©ã†ãªã‚‹ï¼Ÿ", options: ["0ã‚’è¿”ã™ï¼ˆEOFï¼‰", "ã‚¨ãƒ©ãƒ¼ï¼ˆ-1ï¼‰ã‚’è¿”ã™", "ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹", "SIGPIPEãŒç™ºç”Ÿã™ã‚‹"], correct: 0, rationale: "æ›¸ãæ‰‹ãŒèª°ã‚‚ã„ãªããªã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«çµ‚äº†ï¼ˆEOFï¼‰ã€æ‰±ã„ã¨ãªã‚Šã€readã¯0ã‚’è¿”ã—ã¾ã™ã€‚ã“ã‚ŒãŒãƒ«ãƒ¼ãƒ—çµ‚äº†ã®æ¡ä»¶ã«ãªã‚Šã¾ã™ã€‚", hint: "man 7 pipe: 'If all file descriptors referring to the write end... are closed, then read(2) returns 0.'" },
        { q: "å­ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã—ãŸãŒã€è¦ªãƒ—ãƒ­ã‚»ã‚¹ãŒã¾ã  wait() ã—ã¦ã„ãªã„çŠ¶æ…‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä½•ã¨å‘¼ã¶ï¼Ÿ", options: ["ã‚ªãƒ¼ãƒ•ã‚¡ãƒ³ï¼ˆå­¤å…ï¼‰ãƒ—ãƒ­ã‚»ã‚¹", "ã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹", "ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ—ãƒ­ã‚»ã‚¹", "ã‚¹ãƒªãƒ¼ãƒ”ãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹"], correct: 1, rationale: "çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¦ªãŒå›åã™ã‚‹ã¾ã§ã€ãƒ—ãƒ­ã‚»ã‚¹ã‚¨ãƒ³ãƒˆãƒªã ã‘ãŒæ®‹ã£ãŸçŠ¶æ…‹ã‚’ã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹ã¨å‘¼ã³ã¾ã™ã€‚", hint: "man 2 wait: 'A child that terminates, but has not yet been waited for, becomes a zombie.'" },
        { q: "execve() ã‚’å®Ÿè¡Œã—ãŸéš›ã€FD_CLOEXECãƒ•ãƒ©ã‚°ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã¯ã©ã†ãªã‚‹ï¼Ÿ", options: ["é–‹ã‹ã‚ŒãŸã¾ã¾ç¶™æ‰¿ã•ã‚Œã‚‹", "è‡ªå‹•çš„ã«é–‰ã˜ã‚‰ã‚Œã‚‹", "è¤‡è£½ã•ã‚Œã‚‹", "ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹"], correct: 1, rationale: "FD_CLOEXEC (Close-On-Exec) ã¯ã€ãã®åã®é€šã‚Š exec æˆåŠŸæ™‚ã«è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°ã§ã™ã€‚", hint: "man 2 open: 'O_CLOEXEC... The file descriptor will automatically be closed during a successful execve(2).'" },
        { q: "fork() ã®ãƒ¡ãƒ¢ãƒªè¤‡è£½ã«ãŠã„ã¦ã€Œã‚³ãƒ”ãƒ¼ã‚ªãƒ³ãƒ©ã‚¤ãƒˆ (COW)ã€ã¨ã¯ã©ã®ã‚ˆã†ãªæŒ™å‹•ã‹ï¼Ÿ", options: ["å³åº§ã«å…¨ãƒ¡ãƒ¢ãƒªã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹", "è¦ªã®ãƒ¡ãƒ¢ãƒªã‚’å…±æœ‰ã—ã€æ›¸ãè¾¼ã¿ãŒç™ºç”Ÿã—ãŸãƒšãƒ¼ã‚¸ã ã‘ã‚³ãƒ”ãƒ¼ã™ã‚‹", "ã‚¹ã‚¿ãƒƒã‚¯ã®ã¿ã‚³ãƒ”ãƒ¼ã—ãƒ’ãƒ¼ãƒ—ã¯å…±æœ‰ã™ã‚‹", "å­ãƒ—ãƒ­ã‚»ã‚¹ã¯ãƒ¡ãƒ¢ãƒªã‚’æŒãŸãªã„"], correct: 1, rationale: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã€æœ€åˆã¯ç‰©ç†ãƒ¡ãƒ¢ãƒªã‚’å…±æœ‰ã—ã€ã©ã¡ã‚‰ã‹ãŒãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãæ›ãˆãŸç¬é–“ã ã‘ãã®ãƒšãƒ¼ã‚¸ã‚’è¤‡è£½ã—ã¾ã™ã€‚", hint: "man 2 fork: '...copy-on-write pages.'" },
        { q: "æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® exit() ã¨ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã® _exit() ã®æ±ºå®šçš„ãªé•ã„ã¯ï¼Ÿ", options: ["çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ç¯„å›²", "ãƒãƒƒãƒ•ã‚¡ï¼ˆstdioï¼‰ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚’è¡Œã†ã‹ã©ã†ã‹", "è¦ªãƒ—ãƒ­ã‚»ã‚¹ã¸ã®é€šçŸ¥æ–¹æ³•", "é•ã„ã¯ãªã„"], correct: 1, rationale: "exit() ã¯çµ‚äº†å‰ã«stdioãƒãƒƒãƒ•ã‚¡ï¼ˆprintfã®ä¸­èº«ãªã©ï¼‰ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ãŒã€_exit() ã¯å³åº§ã«ã‚«ãƒ¼ãƒãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚", hint: "man 3 exit: 'The function _exit() terminates... file descriptors... are not flushed.'" },
        { q: "dup(oldfd) ã¯ã€æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ç•ªå·ã¨ã—ã¦ä½•ã‚’ä½¿ã†ï¼Ÿ", options: ["oldfd + 1", "ç¾åœ¨ä½¿ç”¨å¯èƒ½ãªæœ€å°ã®ç•ªå·", "ãƒ©ãƒ³ãƒ€ãƒ ãªç•ªå·", "å¸¸ã«3"], correct: 1, rationale: "dupç³»ã¯å¸¸ã«ã€Œç¾åœ¨é–‹ã„ã¦ã„ãªã„æœ€å°ã®æ•´æ•°ã€ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚", hint: "man 2 dup: 'The new file descriptor uses the lowest-numbered unused file descriptor...'" },
        { q: "è¦ªãƒ—ãƒ­ã‚»ã‚¹ãŒ wait() ã›ãšã«å…ˆã«çµ‚äº†ã—ã¦ã—ã¾ã£ãŸå ´åˆã€æ®‹ã•ã‚ŒãŸå­ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆå­¤å…ï¼‰ã®è¦ªã¯èª°ã«ãªã‚‹ï¼Ÿ", options: ["æ¶ˆæ»…ã™ã‚‹", "initãƒ—ãƒ­ã‚»ã‚¹ (PID 1) ã¾ãŸã¯ subreaper", "ã‚·ã‚§ãƒ«", "ã‚«ãƒ¼ãƒãƒ«"], correct: 1, rationale: "è¦ªã‚’å¤±ã£ãŸãƒ—ãƒ­ã‚»ã‚¹ã¯ initï¼ˆæœ€è¿‘ã®Linuxã§ã¯systemdãªã©ï¼‰é¤Šå­ã«å‡ºã•ã‚Œã€ãã“ã§waitãŒè¡Œã‚ã‚Œã¾ã™ã€‚", hint: "man 2 exit: 'Orphaned children ... are adopted by init(1)...'" },
        { q: "waitpid() ã®ç¬¬ä¸€å¼•æ•°ã« -1 ã‚’æŒ‡å®šã—ãŸå ´åˆã®æ„å‘³ã¯ï¼Ÿ", options: ["ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—IDãŒ1ã®å­ã‚’å¾…ã¤", "ç‰¹å®šã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¾…ãŸãªã„ï¼ˆä»»æ„ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¾…ã¤ï¼‰", "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã®ã¿è¡Œã†", "è¦ªãƒ—ãƒ­ã‚»ã‚¹è‡ªèº«ã‚’å¾…ã¤"], correct: 1, rationale: "pid < -1, pid == -1, pid == 0, pid > 0 ã§æŒ™å‹•ãŒç•°ãªã‚Šã¾ã™ã€‚-1ã¯ wait() ã¨åŒã˜ãã€Œèª°ã§ã‚‚ã„ã„ã‹ã‚‰çµ‚ã‚ã‚‹ã®ã‚’å¾…ã¤ã€æŒ™å‹•ã§ã™ã€‚", hint: "man 2 wait: 'waitpid(-1, &status, 0) is equivalent to wait(&status).'" },
        { q: "pipe() ã§ä½œæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã®æ€§è³ªã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ï¼Ÿï¼ˆLinuxã«ãŠã„ã¦ï¼‰", options: ["åŒæ–¹å‘é€šä¿¡ãŒå¯èƒ½", "å˜æ–¹å‘ï¼ˆä¸€æ–¹å‘ï¼‰é€šä¿¡ã®ã¿", "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã«ä½¿ç”¨å¯èƒ½", "ã‚·ãƒ¼ã‚¯ï¼ˆlseekï¼‰ãŒå¯èƒ½"], correct: 1, rationale: "æ¨™æº–çš„ãªãƒ‘ã‚¤ãƒ—ã¯å˜æ–¹å‘ã§ã™ã€‚èª­ã¿è¾¼ã¿ç«¯ã¨æ›¸ãè¾¼ã¿ç«¯ãŒæ˜ç¢ºã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚", hint: "man 7 pipe: 'Pipes and FIFOs ... are purely unidirectional I/O channels.'" }
    ];

    const batch2 = [
        { q: "ãƒ‘ã‚¤ãƒ—ã®ãƒãƒƒãƒ•ã‚¡ãŒæº€æ¯ã®çŠ¶æ…‹ã§ write() ã‚’è¡Œã†ã¨ã©ã†ãªã‚‹ï¼Ÿï¼ˆO_NONBLOCKãªã—ï¼‰", options: ["ãƒ‡ãƒ¼ã‚¿ãŒæ¨ã¦ã‚‰ã‚Œã‚‹", "ã‚¨ãƒ©ãƒ¼(EAGAIN)ãŒè¿”ã‚‹", "æ›¸ãè¾¼ã¿ã‚¹ãƒšãƒ¼ã‚¹ãŒç©ºãã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹", "ãƒãƒƒãƒ•ã‚¡ãŒè‡ªå‹•æ‹¡å¼µã•ã‚Œã‚‹"], correct: 2, rationale: "èª­ã¿æ‰‹ãŒãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚“ã§ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç©ºã‘ã‚‹ã¾ã§ã€æ›¸ãè¾¼ã¿ãƒ—ãƒ­ã‚»ã‚¹ã¯ã‚¹ãƒªãƒ¼ãƒ—ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ï¼‰ã•ã›ã‚‰ã‚Œã¾ã™ã€‚", hint: "man 7 pipe: 'If the pipe is full, then write(2) blocks...'" },
        { q: "å­ãƒ—ãƒ­ã‚»ã‚¹ãŒåœæ­¢ï¼ˆStopï¼‰ã¾ãŸã¯çµ‚äº†ã—ãŸæ™‚ã«è¦ªãƒ—ãƒ­ã‚»ã‚¹ã«é€ã‚‰ã‚Œã‚‹ã‚·ã‚°ãƒŠãƒ«ã¯ï¼Ÿ", options: ["SIGPIPE", "SIGCHLD", "SIGTERM", "SIGUSR1"], correct: 1, rationale: "ã‚«ãƒ¼ãƒãƒ«ã¯å­ãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹å¤‰åŒ–æ™‚ã« SIGCHLD ã‚’è¦ªã«é€ã‚Šã¾ã™ã€‚", hint: "man 7 signal: 'SIGCHLD: Child stopped or terminated.'" },
        { q: "dup2(oldfd, newfd) ã«ãŠã„ã¦ã€newfd ãŒæ—¢ã«é–‹ã‹ã‚Œã¦ã„ãŸå ´åˆã©ã†ãªã‚‹ï¼Ÿ", options: ["ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹", "æš—é»™çš„ã« close(newfd) ã•ã‚Œã¦ã‹ã‚‰è¤‡è£½ã•ã‚Œã‚‹", "newfd ã®å†…å®¹ã¯ä¿æŒã•ã‚Œã‚‹", "æœªå®šç¾©å‹•ä½œ"], correct: 1, rationale: "dup2ã¯æŒ‡å®šã•ã‚ŒãŸnewfdã‚’ä½¿ãŠã†ã¨ã—ã¾ã™ã€‚ã‚‚ã—ä½¿ç”¨ä¸­ãªã‚‰ã€ã¾ãšãã‚Œã‚’é–‰ã˜ã¦ã‹ã‚‰è¤‡è£½ã‚’è¡Œã„ã¾ã™ã€‚", hint: "man 2 dup2: 'If newfd was open... close(2) are lost.'" },
        { q: "open() ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ unlink() ã§å‰Šé™¤ã—ãŸå ´åˆã€ãã®FDã‚’æŒã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã©ã†ãªã‚‹ï¼Ÿ", options: ["å³åº§ã«ã‚¨ãƒ©ãƒ¼(EBADF)ã«ãªã‚‹", "FDã‚’é–‰ã˜ã‚‹ã¾ã§èª­ã¿æ›¸ãå¯èƒ½", "èª­ã¿è¾¼ã¿ã®ã¿å¯èƒ½", "ãƒ—ãƒ­ã‚»ã‚¹ãŒå¼·åˆ¶çµ‚äº†ã™ã‚‹"], correct: 1, rationale: "Unixãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æœ‰åãªæŒ™å‹•ã§ã™ã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¨ãƒ³ãƒˆãƒªã¯æ¶ˆãˆã¾ã™ãŒã€inodeã¨ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚", hint: "man 2 unlink: 'the file will remain in existence...'" },
        { q: "vfork() ã¨ fork() ã®ä¸»ãªé•ã„ã¯ï¼Ÿ", options: ["vforkã¯è¦ªãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ãªã„ï¼ˆãƒ¡ãƒ¢ãƒªå…±æœ‰ï¼‰", "vforkã¯åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œã‚‹", "vforkã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã‚’å…±æœ‰ã—ãªã„", "vforkã¯ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚‰ãªã„"], correct: 0, rationale: "vforkã¯è¦ªã®ãƒšãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã›ãšã€execã‹_exitã™ã‚‹ã¾ã§è¦ªã®ãƒ¡ãƒ¢ãƒªç©ºé–“ã‚’å€Ÿç”¨ã—ã€ãã®é–“è¦ªã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚", hint: "man 2 vfork" },
        { q: "waitç³»ã®ãƒã‚¯ãƒ­ WIFEXITED(status) ãŒçœŸã«ãªã‚‹ã®ã¯ã„ã¤ï¼Ÿ", options: ["ã‚·ã‚°ãƒŠãƒ«ã§çµ‚äº†ã—ãŸæ™‚", "æ­£å¸¸ã« exit() ã‚„ mainã‹ã‚‰ã®return ã§çµ‚äº†ã—ãŸæ™‚", "ä¸€æ™‚åœæ­¢ã—ãŸæ™‚", "å†é–‹ã—ãŸæ™‚"], correct: 1, rationale: "çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ¤œæŸ»ã™ã‚‹ãƒã‚¯ãƒ­ã§ã™ã€‚ç•°å¸¸çµ‚äº†ï¼ˆã‚·ã‚°ãƒŠãƒ«æ­»ï¼‰ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚", hint: "man 2 wait" },
        { q: "æ¨™æº–å…¥åŠ›ã€æ¨™æº–å‡ºåŠ›ã€æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ç•ªå·ã®çµ„ã¿åˆã‚ã›ã¯ï¼Ÿ", options: ["1, 2, 3", "0, 1, 2", "-1, 0, 1", "ä»»æ„"], correct: 1, rationale: "åŸºæœ¬ä¸­ã®åŸºæœ¬ã§ã™ãŒã€pipeå‡¦ç†ã§ dup2(fd, 1) ã®ã‚ˆã†ã«å®šæ•°ã‚’ä½¿ã†éš›ã«å¿…é ˆã®çŸ¥è­˜ã§ã™ã€‚", hint: "man 3 stdin" },
        { q: "Linuxã«ãŠã„ã¦ã€ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒ©å†…ã§ä½¿ç”¨ã—ã¦ã‚‚å®‰å…¨ãªï¼ˆéåŒæœŸã‚·ã‚°ãƒŠãƒ«ã‚»ãƒ¼ãƒ•ãªï¼‰é–¢æ•°ã¯ã©ã‚Œï¼Ÿ", options: ["printf()", "malloc()", "write()", "exit()"], correct: 2, rationale: "printfã‚„mallocã¯ãƒ­ãƒƒã‚¯ã‚’ä½¿ã†ãŸã‚å®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚writeã¯å®‰å…¨ã§ã™ã€‚", hint: "man 7 signal-safety" },
        { q: "ãƒ—ãƒ­ã‚»ã‚¹ãŒ fork() ã™ã‚‹éš›ã€è¦ªãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹ã„ã¦ã„ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆopendirç­‰ï¼‰ã¯ã©ã†ãªã‚‹ï¼Ÿ", options: ["å­ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚‚ç¶™æ‰¿ã•ã‚Œã‚‹", "å­ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯é–‰ã˜ã‚‰ã‚Œã‚‹", "å­ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹", "ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹"], correct: 0, rationale: "ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚‚å†…éƒ¨çš„ã«ã¯FDã‚’æŒã£ã¦ã„ã¾ã™ãŒã€forkæ™‚ã¯è¦ªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆã”ã¨ç¶™æ‰¿ã•ã‚Œã¾ã™ã€‚", hint: "man 2 fork" },
        { q: "system() é–¢æ•°ã¨ exec() ç³»ã®é–¢æ•°ã®æœ€å¤§ã®é•ã„ã¯ï¼Ÿ", options: ["systemã¯ã‚·ã‚§ãƒ«çµŒç”±ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—æˆ»ã£ã¦ãã‚‹", "systemã¯ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç½®æ›ã™ã‚‹", "systemã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹", "systemã¯rootæ¨©é™ã§å®Ÿè¡Œã™ã‚‹"], correct: 0, rationale: "execã¯è‡ªåˆ†è‡ªèº«ã‚’æ›¸ãæ›ãˆã¾ã™ãŒã€systemã¯å†…éƒ¨ã§ fork -> exec('/bin/sh', ...) -> wait ã‚’è¡Œã„ã€å‘¼ã³å‡ºã—å…ƒã«æˆ»ã£ã¦ãã¾ã™ã€‚", hint: "man 3 system" }
    ];

    const batch3 = [
        { q: "fork() ã—ãŸéš›ã€è¦ªã¨å­ã§å…±æœ‰ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆèª­ã¿æ›¸ãã®ä½ç½®ï¼‰ã¯ã©ã†ãªã‚‹ï¼Ÿ", options: ["å…±æœ‰ã•ã‚Œã‚‹ï¼ˆè¦ªãŒèª­ã‚€ã¨å­ã®ä½ç½®ã‚‚é€²ã‚€ï¼‰", "å…±æœ‰ã•ã‚Œãªã„ï¼ˆç‹¬ç«‹ã—ã¦ã„ã‚‹ï¼‰", "0ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹", "èª­ã¿è¾¼ã¿ã®ã¿å…±æœ‰ã•ã‚Œã‚‹"], correct: 0, rationale: "ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ä½“ï¼ˆfile descriptionï¼‰ã¯å…±æœ‰ã•ã‚Œã‚‹ãŸã‚ã€è¦ªãŒ read() ã§é€²ã‚ãŸä½ç½®ã¯ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚‚å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚", hint: "man 2 fork: 'The file offset is shared between the parent and child.'" },
        { q: "setpgid(0, 0) ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", options: ["ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹", "å‘¼ã³å‡ºã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã®PGIDãŒã€ãã®PIDã¨åŒã˜ã«ãªã‚‹", "ãƒ«ãƒ¼ãƒˆæ¨©é™ã‚’å–å¾—ã™ã‚‹", "ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰è„±é€€ã™ã‚‹"], correct: 1, rationale: "å¼•æ•°ãŒ0ã®å ´åˆã€ç¾åœ¨ã®ãƒ—ãƒ­ã‚»ã‚¹PIDãŒä½¿ã‚ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€Œè‡ªåˆ†ãŒãƒªãƒ¼ãƒ€ãƒ¼ã¨ãªã‚‹æ–°ã—ã„ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œã‚‹ã€å‹•ä½œã§ã™ã€‚", hint: "man 2 setpgid" },
        { q: "è£œè¶³ã§ããªã„ï¼ˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã§ããªã„ï¼‰ã‚·ã‚°ãƒŠãƒ«ã®çµ„ã¿åˆã‚ã›ã¯ï¼Ÿ", options: ["SIGINT ã¨ SIGTERM", "SIGKILL ã¨ SIGSTOP", "SIGSEGV ã¨ SIGBUS", "SIGHUP ã¨ SIGPIPE"], correct: 1, rationale: "SIGKILLï¼ˆå¼·åˆ¶çµ‚äº†ï¼‰ã¨ SIGSTOPï¼ˆä¸€æ™‚åœæ­¢ï¼‰ã¯ã€ã‚«ãƒ¼ãƒãƒ«ãŒå¼·åˆ¶çš„ã«å‡¦ç†ã™ã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å´ã§ç„¡è¦–ã‚„æ•æ‰ãŒã§ãã¾ã›ã‚“ã€‚", hint: "man 7 signal" },
        { q: "waitpid(-pgid, &status, 0) ã®ã‚ˆã†ã«ã€ç¬¬ä¸€å¼•æ•°ã«è² ã®å€¤ã‚’æŒ‡å®šã—ãŸå ´åˆã®æ„å‘³ã¯ï¼Ÿ", options: ["ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹", "ãã®çµ¶å¯¾å€¤ã®PIDã‚’æŒã¤ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¾…ã¤", "ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—IDãŒ |pgid| ã§ã‚ã‚‹å­ãƒ—ãƒ­ã‚»ã‚¹ç¾¤ã®ã©ã‚Œã‹ã‚’å¾…ã¤", "è¦ªãƒ—ãƒ­ã‚»ã‚¹ã‚ˆã‚Šè‹¥ã„PIDã‚’å¾…ã¤"], correct: 2, rationale: "è² ã®å€¤ã¯ã€Œãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã€æŒ‡å®šã§ã™ã€‚", hint: "man 2 wait" },
        { q: "ãƒ‘ã‚¤ãƒ—ã«å¯¾ã—ã¦ lseek() ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€errno ã«ã¯ä½•ãŒã‚»ãƒƒãƒˆã•ã‚Œã‚‹ï¼Ÿ", options: ["EINVAL", "ESPIPE", "EIO", "ENOTTY"], correct: 1, rationale: "ãƒ‘ã‚¤ãƒ—ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§ã‚ã‚Šã€ã‚·ãƒ¼ã‚¯ï¼ˆä½ç½®ç§»å‹•ï¼‰ã¯ã§ãã¾ã›ã‚“ã€‚å°‚ç”¨ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ ESPIPE ãŒè¿”ã‚Šã¾ã™ã€‚", hint: "man 2 lseek" },
        { q: "ã™ã§ã« close ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã‚’å†åº¦ close() ã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", options: ["ä½•ã‚‚ã—ãªã„ï¼ˆæˆåŠŸæ‰±ã„ï¼‰", "ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹", "-1ã‚’è¿”ã—ã€errnoã«EBADFã‚’è¨­å®šã™ã‚‹", "æœªå®šç¾©å‹•ä½œ"], correct: 2, rationale: "äºŒé‡ã‚¯ãƒ­ãƒ¼ã‚ºã¯ãƒã‚°ã®å…†å€™ã§ã™ã€‚å¿…ãšã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã¹ãã§ã™ã€‚", hint: "man 2 close" },
        { q: "execé–¢æ•°ç¾¤ã®ä¸­ã§ã€ç’°å¢ƒå¤‰æ•°ï¼ˆenvironï¼‰ã‚’ç¾åœ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰è‡ªå‹•çš„ã«å¼•ãç¶™ãŒãªã„ã®ã¯ï¼Ÿ", options: ["execlp", "execvp", "execv", "execve"], correct: 3, rationale: "execve ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ãã®ã‚‚ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã‚’é…åˆ—ã¨ã—ã¦æ˜ç¤ºçš„ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", hint: "man 2 execve" },
        { q: "O_APPEND ãƒ•ãƒ©ã‚°ä»˜ãã§ open ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ãŒæ›¸ãè¾¼ã‚€å ´åˆã€ç«¶åˆã¯ã©ã†ãªã‚‹ï¼Ÿ", options: ["ãƒ‡ãƒ¼ã‚¿ãŒæ··ã–ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹", "OSãŒåŸå­æ€§ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼‰ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚æ··ã–ã‚‰ãªã„", "å¾Œã‹ã‚‰æ›¸ã„ãŸæ–¹ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹", "ãƒ­ãƒƒã‚¯ã—ãªã„ã¨å¿…ãšå£Šã‚Œã‚‹"], correct: 1, rationale: "O_APPEND ãƒ¢ãƒ¼ãƒ‰ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã¸ã®ç§»å‹•ã¨æ›¸ãè¾¼ã¿ãŒã‚¢ãƒˆãƒŸãƒƒã‚¯ã«è¡Œã‚ã‚Œã¾ã™ã€‚", hint: "man 2 open: 'atomic.'" },
        { q: "å­ãƒ—ãƒ­ã‚»ã‚¹å†…ã§ exit(0) ã™ã‚‹ã®ã¨ return 0 ã™ã‚‹ã®ã®ä¸»ãªé•ã„ã¯ï¼Ÿï¼ˆmainé–¢æ•°å†…ï¼‰", options: ["é•ã„ã¯ãªã„", "returnã¯å†å¸°çš„ã«è¦ªã‚’å‘¼ã¶", "exitã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒèµ°ã‚‹ãŒreturnã¯èµ°ã‚‰ãªã„", "returnã¯ã‚¹ã‚¿ãƒƒã‚¯è§£æ”¾ã®ã¿"], correct: 0, rationale: "mainé–¢æ•°ã®ä¸­ã§ã‚ã‚Œã°ã€`return n;` ã¯ `exit(n);` ã¨åŒç­‰ã§ã™ï¼ˆC99è¦æ ¼ï¼‰ã€‚", hint: "C Standard" },
        { q: "kill(0, SIGINT) ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚·ã‚°ãƒŠãƒ«ã¯ã©ã“ã«é€ã‚‰ã‚Œã‚‹ï¼Ÿ", options: ["PID 0 (swapper)", "å…¨ãƒ—ãƒ­ã‚»ã‚¹", "è‡ªåˆ†ã¨åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã«å±ã™ã‚‹å…¨ãƒ—ãƒ­ã‚»ã‚¹", "è‡ªåˆ†è‡ªèº«ã®ã¿"], correct: 2, rationale: "killã®pid 0ã¯ã€Œã‚«ãƒ¬ãƒ³ãƒˆãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€ã‚’æ„å‘³ã—ã¾ã™ã€‚", hint: "man 2 kill" }
    ];

    const batch4 = [
        { q: "printf('Hello'); fork(); ã¨ã—ãŸå ´åˆï¼ˆæ”¹è¡Œãªã—ï¼‰ã€å‡ºåŠ›ã¯ã©ã†ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ï¼Ÿ", options: ["Hello ãŒ1å›ã ã‘", "HelloHello ã¨2å›", "ä½•ã‚‚å‡ºãªã„", "ã‚¨ãƒ©ãƒ¼"], correct: 1, rationale: "æ”¹è¡ŒãŒãªã„ã¨ãƒãƒƒãƒ•ã‚¡ã«ç•™ã¾ã‚Šã¾ã™ã€‚forkæ™‚ã«ãƒãƒƒãƒ•ã‚¡ã”ã¨ã‚³ãƒ”ãƒ¼ã•ã‚Œã€è¦ªã¨å­ã®çµ‚äº†æ™‚ã«ãã‚Œãã‚Œãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ãŸã‚2å›å‡ºã¾ã™ã€‚", hint: "fork duplicates the exact state of the buffer." },
        { q: "WEXITSTATUS(status) ãƒã‚¯ãƒ­ã‚’ä½¿ã†å‰ã«ã€å¿…ãšãƒã‚§ãƒƒã‚¯ã™ã¹ããƒã‚¯ãƒ­ã¯ï¼Ÿ", options: ["WIFSTOPPED", "WIFSIGNALED", "WIFEXITED", "WCOREDUMP"], correct: 2, rationale: "ã‚·ã‚°ãƒŠãƒ«ã§æ­»ã‚“ã å ´åˆã€çµ‚äº†ã‚³ãƒ¼ãƒ‰ã¯ç„¡æ„å‘³ã§ã™ã€‚æ­£å¸¸çµ‚äº†ã—ãŸã‹ `WIFEXITED` ã§ç¢ºèªã™ã‚‹ã®ãŒå®šçŸ³ã§ã™ã€‚", hint: "man 2 wait" },
        { q: "malloc() ã§ç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€fork() å¾Œã©ã†ãªã‚‹ï¼Ÿ", options: ["å­ã§ã¯è§£æ”¾", "è¦ªã¨å­ã§ç‰©ç†ãƒ¡ãƒ¢ãƒªå…±æœ‰ï¼ˆå¤‰æ›´åæ˜ ï¼‰", "è«–ç†çš„ã«è¤‡è£½ã•ã‚Œç‹¬ç«‹ã™ã‚‹", "å­ã§ã¯0åˆæœŸåŒ–"], correct: 2, rationale: "ãƒ’ãƒ¼ãƒ—é ˜åŸŸã‚‚ã‚¹ã‚¿ãƒƒã‚¯åŒæ§˜ã«è¤‡è£½ï¼ˆCOWï¼‰ã•ã‚Œã¾ã™ã€‚ãƒã‚¤ãƒ³ã‚¿å€¤ã¯åŒã˜ã§ã‚‚ç‰©ç†ãƒ¡ãƒ¢ãƒªã¯åˆ¥ç‰©ã§ã™ã€‚", hint: "man 2 fork" },
        { q: "atexit() ã§ç™»éŒ²ã—ãŸé–¢æ•°ã¯ã€_exit() ã§çµ‚äº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼Ÿ", options: ["å®Ÿè¡Œã•ã‚Œã‚‹", "å®Ÿè¡Œã•ã‚Œãªã„", "OSã«ã‚ˆã‚‹", "è¦ªã®ã¿å®Ÿè¡Œ"], correct: 1, rationale: "`_exit()` ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç›´çµã§ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¬ãƒ™ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆatexitç­‰ï¼‰ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ã€‚", hint: "man 2 _exit" },
        { q: "read(fd, buf, 100) ãŒ 50 ã‚’è¿”ã—ãŸå ´åˆã®æ„å‘³ã¯ï¼Ÿ", options: ["ã‚¨ãƒ©ãƒ¼", "EOF", "50ãƒã‚¤ãƒˆèª­ã¿è¾¼ã‚ãŸï¼ˆæ­£å¸¸ï¼‰", "ç ´æ£„ã•ã‚ŒãŸ"], correct: 2, rationale: "readã¯è¦æ±‚ã‚µã‚¤ã‚ºã‚ˆã‚Šå°‘ãªãèª­ã‚€ã“ã¨ãŒé »ç¹ã«ã‚ã‚Šã¾ã™ã€‚", hint: "man 2 read" },
        { q: "ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒ©å†…ã§ errno ã‚’å¤‰æ›´ã—ã¦ã—ã¾ã†ã¨ã€ãƒ¡ã‚¤ãƒ³å‡¦ç†ã«ã©ã‚“ãªæ‚ªå½±éŸ¿ãŒã‚ã‚‹ï¼Ÿ", options: ["å½±éŸ¿ãªã„", "ãƒ¡ã‚¤ãƒ³å‡¦ç†ã®errnoãƒã‚§ãƒƒã‚¯ãŒèª¤å‹•ä½œã™ã‚‹", "ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢", "SEGV"], correct: 1, rationale: "ãƒãƒ³ãƒ‰ãƒ©å†…ã§ `write` ç­‰ã‚’ã—ã¦ `errno` ã‚’æ›¸ãæ›ãˆã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³å‡¦ç†ãŒèª¤ã£ãŸã‚¨ãƒ©ãƒ¼åŸå› ã‚’å‚ç…§ã—ã¦ã—ã¾ã„ã¾ã™ã€‚", hint: "Save and restore errno." },
        { q: "ã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤§é‡ã«ç™ºç”Ÿã—ã¦PIDã‚’ä½¿ã„åˆ‡ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", options: ["å¤ã„é †ã«æ¶ˆãˆã‚‹", "æ–°ã—ã„ãƒ—ãƒ­ã‚»ã‚¹ãŒä½œã‚Œãªããªã‚‹", "ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ‹ãƒƒã‚¯", "è¦ªãŒå¼·åˆ¶çµ‚äº†"], correct: 1, rationale: "PIDãƒ†ãƒ¼ãƒ–ãƒ«ãŒåŸ‹ã¾ã‚‹ã¨ `fork()` ãŒ `EAGAIN` ã§å¤±æ•—ã—ã¾ã™ã€‚", hint: "man 2 fork" },
        { q: "PIPE_BUFï¼ˆé€šå¸¸4KBï¼‰ã‚ˆã‚Šå¤§ããªãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã« write() ã—ãŸå ´åˆã®åŸå­æ€§ã¯ï¼Ÿ", options: ["ä¿è¨¼ã•ã‚Œã‚‹", "ä¿è¨¼ã•ã‚Œãªã„ï¼ˆæ··ã–ã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰", "ã‚¨ãƒ©ãƒ¼", "æœ€åˆã®4KBã ã‘æ›¸ã‹ã‚Œã‚‹"], correct: 1, rationale: "PIPE_BUFã‚’è¶…ãˆã‚‹æ›¸ãè¾¼ã¿ã¯ã€ã‚«ãƒ¼ãƒãƒ«ã«ã‚ˆã£ã¦åˆ†å‰²ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚", hint: "man 7 pipe" },
        { q: "å­ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰è¦ªã¸å˜ç´”ãªæ•´æ•°ï¼ˆçµ‚äº†çŠ¶æ…‹ï¼‰ã‚’æ¸¡ã™æœ€ã‚‚æ¨™æº–çš„ãªæ–¹æ³•ã¯ï¼Ÿ", options: ["ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°", "exit() ã®å¼•æ•°ã¨ wait()", "å…±æœ‰ãƒ¡ãƒ¢ãƒª", "ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«"], correct: 1, rationale: "`exit(n)` ã™ã‚Œã°ã€è¦ªã¯ `wait` ã—ã¦ `WEXITSTATUS` ã§ `n` ã‚’å—ã‘å–ã‚Œã¾ã™ï¼ˆ0-255ï¼‰ã€‚", hint: "man 3 exit" },
        { q: "fcntl(fd, F_SETFL, O_NONBLOCK) ã®å½¹å‰²ã¯ï¼Ÿ", options: ["FDã‚’é–‰ã˜ã‚‹", "èª­ã¿è¾¼ã¿å°‚ç”¨ã«ã™ã‚‹", "ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´", "FDã‚’è¤‡è£½"], correct: 2, rationale: "èª­ã¿è¾¼ã¿ã§æ­¢ã¾ã£ã¦ã»ã—ããªã„å ´åˆã«ä½¿ã„ã¾ã™ã€‚", hint: "man 2 fcntl" }
    ];

    const quizBatches = [batch1, batch2, batch3, batch4];

    // === STATE ===
    let currentBatchIdx = 0;
    let currentQuizData = [];
    let currentQIdx = 0;
    let score = 0;

    // === DOM ELEMENTS ===
    const menuView = document.getElementById('menu-view');
    const quizView = document.getElementById('quiz-view');
    const resultView = document.getElementById('result-view');
    
    const batchLabel = document.getElementById('batch-label');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedback = document.getElementById('feedback');
    const feedbackTitle = document.getElementById('feedback-title');
    const feedbackText = document.getElementById('feedback-text');
    const nextBtn = document.getElementById('next-btn');
    const currentQEl = document.getElementById('current-q');
    const totalQEl = document.getElementById('total-q');
    
    // Hint Elements
    const hintText = document.getElementById('hint-text');

    // === LOGIC ===

    function initMenu() {
        menuView.classList.remove('hidden');
        quizView.classList.add('hidden');
        resultView.classList.add('hidden');
    }

    function startQuiz(batchIdx) {
        currentBatchIdx = batchIdx;
        currentQuizData = quizBatches[batchIdx];
        currentQIdx = 0;
        score = 0;
        
        batchLabel.textContent = batchIdx + 1;
        totalQEl.textContent = currentQuizData.length;

        menuView.classList.add('hidden');
        resultView.classList.add('hidden');
        quizView.classList.remove('hidden');
        
        loadQuestion();
    }

    function retryQuiz() {
        startQuiz(currentBatchIdx);
    }

    function loadQuestion() {
        const data = currentQuizData[currentQIdx];
        questionText.textContent = data.q;
        
        // ãƒ’ãƒ³ãƒˆã®ãƒªã‚»ãƒƒãƒˆ
        hintText.style.display = 'none';
        hintText.textContent = "Hint: " + data.hint;
        
        optionsContainer.innerHTML = '';
        feedback.style.display = 'none';
        nextBtn.classList.add('hidden');
        currentQEl.textContent = currentQIdx + 1;

        data.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function toggleHint() {
        if (hintText.style.display === 'none') {
            hintText.style.display = 'block';
        } else {
            hintText.style.display = 'none';
        }
    }

    function checkAnswer(selectedIndex, btn) {
        const data = currentQuizData[currentQIdx];
        const buttons = optionsContainer.getElementsByClassName('btn');
        
        Array.from(buttons).forEach(b => b.disabled = true);

        if (selectedIndex === data.correct) {
            btn.classList.add('correct');
            feedbackTitle.textContent = "Correct!";
            feedbackTitle.style.color = "#155724";
            score++;
        } else {
            btn.classList.add('wrong');
            buttons[data.correct].classList.add('correct');
            feedbackTitle.textContent = "Wrong...";
            feedbackTitle.style.color = "#721c24";
        }

        feedbackText.textContent = data.rationale;
        // ãƒ’ãƒ³ãƒˆã¯å›ç­”å¾Œã«ã¯ã‚‚ã†è‡ªå‹•ã§å‡ºã‚‹å¿…è¦ã¯ãªã„ï¼ˆä¸Šã«ã‚ã‚‹ã®ã§ï¼‰ãŒã€
        // å¿µã®ãŸã‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒªã‚¢ã«ã¯å…¥ã‚Œãšã€Rationaleã ã‘ã‚’è¡¨ç¤ºã™ã‚‹å½¢ã«ã—ã¾ã—ãŸã€‚
        
        feedback.style.display = 'block';
        nextBtn.classList.remove('hidden');

        if (currentQIdx === currentQuizData.length - 1) {
            nextBtn.textContent = "Show Result";
        } else {
            nextBtn.textContent = "Next Question";
        }
    }

    function nextQuestion() {
        currentQIdx++;
        if (currentQIdx < currentQuizData.length) {
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        quizView.classList.add('hidden');
        resultView.classList.remove('hidden');
        document.getElementById('score-val').textContent = score;
        document.getElementById('score-total').textContent = currentQuizData.length;

        const msg = document.getElementById('result-message');
        const percentage = score / currentQuizData.length;

        if (percentage === 1) {
            msg.textContent = "å®Œç’§ã§ã™ï¼ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã®é”äººã§ã™ï¼";
        } else if (percentage >= 0.7) {
            msg.textContent = "ç´ æ™´ã‚‰ã—ã„ï¼ã‚ã¨å°‘ã—ã§ãƒã‚¹ã‚¿ãƒ¼ã§ã™ã€‚";
        } else {
            msg.textContent = "å¾©ç¿’ã—ã¦ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¾ã—ã‚‡ã†ï¼";
        }
    }

    // Initialize
    initMenu();
</script>

</body>
</html>
